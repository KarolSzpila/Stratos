/*
 * Airplaine.h
 *
 *  Created on: 29.10.2017
 *      Author: Karol
 */

#ifndef FLIGHTCONTROL_AIRCRAFTRECORD_H_
#define FLIGHTCONTROL_AIRCRAFTRECORD_H_

#include "string"
#include "ADSBMessage.h"

#define DEFAULT_LIVE_SPAN 120U * 1000U //120s in ms

class AircraftRecord
{
public:
	AircraftRecord() = default;
	AircraftRecord(const std::string& ICAO_Address);

	const std::string& GetICAO_Address() const {return ICAO_Address;}
	bool IsRecordExpiered() const {return recordExpiered;}

	void SetAltitude(const uint32_t& newAltitude);
	void SetFlightName(const std::string& newFlightName);

	void SetOddCpr(int oddCprLat,int oddCprLon);
	void SetEvenCpr(int evenCprLat,int evenCprLon);

	const int& GetOddCprTime() const {return oddCprTime;}
	const int& GetEvenCprTime() const {return evenCprTime;}
	uint32_t altitude;
	bool altitudeKnown;
	std::string altStr;

	void Tick(uint32_t ticks);

	void decodeCPR();
private:
	std::string ICAO_Address;

	std::string flightName;
	bool flightNameKnown;


	uint32_t ticksToExpire;
	bool recordExpiered;

	float latitude;
	float lognitude;

	int oddCprLat;
	int oddCprLon;
	bool oddCprValid;
	int oddCprTime;

	int evenCprLat;
	int evenCprLon;
	bool evenCprValid;
	int evenCprTime;

	int cprModFunction(int a, int b);
	int cprNLFunction(double lat);
	int cprNFunction(double lat, int isodd);
	double cprDlonFunction(double lat, int isodd);
};

#endif /* FLIGHTCONTROL_AIRCRAFTRECORD_H_ */
