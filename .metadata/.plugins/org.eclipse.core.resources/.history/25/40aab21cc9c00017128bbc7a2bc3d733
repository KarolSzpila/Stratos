/*
 * FlightControlControler.cpp
 *
 *  Created on: 30.10.2017
 *      Author: Karol
 */

#include "FlightControlControler.h"

FlightControlControler::FlightControlControler(FlightControl& model,FlightCotrolView& view) : model(model), view(view)
{

}

void FlightControlControler::PassNewMessage(const ADS_BMessage& msg)
{
	std::string ICAO_Address = GetICAO_AddresAsString(msg);
	Aircraft* aircraft = model.FindAircraftByICAO_Address(ICAO_Address);
	if(aircraft != NULL)
	{
		aircraft->UpdateStatus(msg);
		view.UpdateAircraft(*aircraft);
	}
	else
	{
		Aircraft new_aircraft(ICAO_Address);
		new_aircraft.UpdateStatus(msg);
		model.AddAircraft(ICAO_Address,new_aircraft);
		view.ShowNewAircraft(new_aircraft);
	}


}

std::string FlightControlControler::GetICAO_AddresAsString(const ADS_BMessage& msg)
{
	char buff[9];
	std::sprintf(buff,"%.2X%.2X%.2X",msg.aa1,msg.aa2,msg.aa3);
	return std::string(buff);
}

void TickUpdate()
{

}
